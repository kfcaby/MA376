# Chunk 1: setup
knitr::opts_chunk$set(echo = TRUE)
# Chunk 2
library(tidyverse)
# Chunk 3
smoke = read.table(file = "smoke.csv", header = T, sep = ",")
smoke$Alive = factor(smoke$Alive)
smoke$Smoker = factor(smoke$Smoker)
smoke %>% group_by(Smoker,Alive) %>% count() %>% spread(key = "Smoker",value = "n")
smoke %>% ggplot(aes(x = Age, y = Smoker, color = Alive)) + geom_jitter(width = 2, height = 0.2)
# Chunk 4
#Let's look at a plot of age vs proportion alive
summary = smoke %>% count(Age, Alive) %>%
group_by(Age) %>%
mutate(Alive_proportion = n/sum(n),
total = sum(n)) %>%
filter(Alive == 1) %>% select(-c(Alive,n))
summary %>%
ggplot(aes(x = Age, y = Alive_proportion)) +
geom_point()
# Chunk 5
summary = summary %>%
mutate(logOdds = log(Alive_proportion/(1-Alive_proportion)))
summary %>% ggplot(aes(x = Age, y = logOdds)) +
geom_point()
# Chunk 6
# In practice, we would just do this:
model_age = glm(Alive ~ Age, data = smoke, family = "binomial")
summary(model_age)
# Chunk 7
summary_model = model_age %>% fortify()
summary_model = summary_model %>% mutate(predicted_prob = exp(.fitted)/(1 + exp(.fitted)))
# Chunk 8
model_smoker = glm(Alive ~ Smoker, data = smoke, family = "binomial")
summary(model_smoker)
setwd("./Chapter_6/")
# Chunk 1: setup
knitr::opts_chunk$set(echo = TRUE)
# Chunk 2
library(tidyverse)
# Chunk 3
smoke = read.table(file = "smoke.csv", header = T, sep = ",")
smoke$Alive = factor(smoke$Alive)
smoke$Smoker = factor(smoke$Smoker)
smoke %>% group_by(Smoker,Alive) %>% count() %>% spread(key = "Smoker",value = "n")
smoke %>% ggplot(aes(x = Age, y = Smoker, color = Alive)) + geom_jitter(width = 2, height = 0.2)
# Chunk 4
#Let's look at a plot of age vs proportion alive
summary = smoke %>% count(Age, Alive) %>%
group_by(Age) %>%
mutate(Alive_proportion = n/sum(n),
total = sum(n)) %>%
filter(Alive == 1) %>% select(-c(Alive,n))
summary %>%
ggplot(aes(x = Age, y = Alive_proportion)) +
geom_point()
# Chunk 5
summary = summary %>%
mutate(logOdds = log(Alive_proportion/(1-Alive_proportion)))
summary %>% ggplot(aes(x = Age, y = logOdds)) +
geom_point()
# Chunk 6
# In practice, we would just do this:
model_age = glm(Alive ~ Age, data = smoke, family = "binomial")
summary(model_age)
# Chunk 7
summary_model = model_age %>% fortify()
summary_model = summary_model %>% mutate(predicted_prob = exp(.fitted)/(1 + exp(.fitted)))
# Chunk 8
model_smoker = glm(Alive ~ Smoker, data = smoke, family = "binomial")
summary(model_smoker)
smoke %>% group_by(Smoker,Alive) %>% count() %>% spread(key = "Smoker",value = "n")
table_smoke = smoke %>% group_by(Smoker,Alive) %>% count() %>% spread(key = "Smoker",value = "n")
table_smoke
chisq.test(table_smoke)
chisq.test(as.matrix(table_smoke))
table_smoke
chisq.test(table_smoke$`1`,table_smoke$`0`)
prop.test(c(443,582),c(502,732))
prop.test(c(443,582),c(502,732), correct = FALSE)
prop.test(c(443,582,20),c(502,732,100), correct = FALSE)
prop.test(c(443,582),c(502,732), correct = FALSE)
table_smoke
0.89^2
10*log(5)
log(5)^10
mtcars
model_crude = lm(mpg ~ wt, data = mtcars)
summary(model_crude)
model_transmission = lm(mpg ~ am, data = mtcars)
summary(model_transmission)
model_adj = lm(mpg ~ am + hp, data = mtcars)
summary(model_adj)
model_adj = lm(mpg ~ am + wt, data = mtcars)
summary(model_adj)
model_adj = lm(mpg ~ am + cyl, data = mtcars)
summary(model_adj)
mtcars %>% filter(am == 1)
mtcars %>% summarise(mean(mpg))
mtcars %>% group_by() %>% summarise(mean(mpg))
mtcars %>% group_by(am) %>% summarise(mean(mpg))
mtcars %>% group_by(am, cyl) %>% summarise(mean(mpg))
mtcars %>% group_by(cyl, am) %>% summarise(mean(mpg))
mtcars %>% group_by(wt, am) %>% summarise(mean(mpg))
mtcars %>% group_by(am) %>% summarise(mean(mpg))
mtcars %>% group_by(cyl, am) %>% summarise(mean(mpg))
mtcars %>% ggplot(aes(x = wt, y = mpg)) %>% geom_point()
mtcars %>% ggplot(aes(x = wt, y = mpg)) + geom_point()
mtcars %>% ggplot(aes(x = wt, y = mpg, color = am)) + geom_point()
mtcars %>% ggplot(aes(x = wt, y = mpg, color = factor(am))) + geom_point()
dim(mtcars)
model_adj = lm(mpg ~ am + wt + hp, data = mtcars)
summary(model_adj)
mtcars
model_adj = lm(mpg ~ am + wt + hp, data = mtcars)
summary(model_adj)
model_adj = lm(mpg ~ am + hp/disp], data = mtcars)
model_adj = lm(mpg ~ am + hp/disp, data = mtcars)
summary(model_adj)
smoke %>% ggplot(aes(x = smoker)) + geom_bar()
library(tidyverse)
smoke %>% ggplot(aes(x = smoker)) + geom_bar()
smoke = read.table(file = "smoke.csv", header = T, sep = ",")
smoke$Alive = factor(smoke$Alive)
smoke$Smoker = factor(smoke$Smoker)
smoke %>% ggplot(aes(x = smoker)) + geom_bar()
setwd("./Chapter_6/")
smoke = read.table(file = "smoke.csv", header = T, sep = ",")
smoke$Alive = factor(smoke$Alive)
smoke$Smoker = factor(smoke$Smoker)
smoke %>% ggplot(aes(x = smoker)) + geom_bar()
smoke %>% ggplot(aes(x = Smoker)) + geom_bar()
smoke %>% ggplot(aes(x = Smoker, color = Alive)) + geom_bar()
smoke %>% ggplot(aes(x = Smoker, fill = Alive)) + geom_bar()
smoke %>% ggplot(aes(x = Smoker, fill = Alive)) + geom_bar(stat = "proportion")
smoke %>% ggplot(aes(x = Smoker, fill = Alive)) + geom_bar(stat = "percent")
smoke %>% ggplot(aes(x = Smoker, fill = Alive)) + geom_bar(stat = "ratio")
smoke %>% ggplot(aes(x = Smoker, y = ..prop.., fill = Alive)) + geom_bar(stat = "ratio")
smoke %>% ggplot(aes(x = Smoker, y = ..prop.., fill = Alive)) + geom_bar()
smoke %>% ggplot(aes(x = Smoker, fill = Alive)) + geom_bar()
smoke %>% ggplot(aes(x = Smoker, fill = Alive)) + geom_bar(stat = "identity")
smoke %>% ggplot(aes(x = Smoker, y = Alive)) + geom_bar(stat = "identity")
smoke %>% ggplot(aes(x = Smoker, fill = Alive)) + geom_bar(stat = "identity")
smoke %>% group_by(Smoker) %>% summarise(prop.alive = mean(Alive))
smoke %>% group_by(Smoker) %>% summarise(prop = n()/sum(n()))
smoke %>% group_by(Smoker, Alive) %>% summarise(prop = n()/sum(n()))
smoke %>% group_by(Smoker, Alive) %>% count()
smoke %>% group_by(Smoker, Alive) %>% count() %>% summarise(prop = n/sum(n))
smoke %>% group_by(Smoker, Alive) %>%
count() %>% group_by(Smoker) %>% summarise(prop = n/sum(n))
smoke %>% group_by(Smoker, Alive) %>%
count() %>% group_by(Smoker) %>% summarise(prop = n/sum(n))
smoke %>% group_by(Smoker, Alive) %>%
count()
smoke %>% group_by(Smoker, Alive) %>%
count() %>% group_by(Smoker) %>% summarise(prop = n/sum(n))
smoke %>% group_by(Smoker, Alive) %>%
count() %>%  summarise(prop = n/sum(n))
smoke %>% group_by(Smoker, Alive) %>%
count() %>%  group_by(Smoker) %>% mutate(prop = n/sum(n))
166/(166+502)
summary %>% ggplot(aes(x = Smoker, y = prop, fill = Alive)) +
geom_col()
summary = smoke %>% group_by(Smoker, Alive) %>%
count() %>%  group_by(Smoker) %>% mutate(prop = n/sum(n))
summary %>% ggplot(aes(x = Smoker, y = prop, fill = Alive)) +
geom_col()
smoke = read.table(file = "smoke.csv", header = T, sep = ",")
smoke$Alive = factor(smoke$Alive)
smoke$Smoker = factor(smoke$Smoker)
summary = smoke %>% group_by(Smoker, Alive) %>%
count() %>%  group_by(Smoker) %>% mutate(prop = n/sum(n))
summary %>% ggplot(aes(x = Smoker, y = prop, fill = Alive)) +
geom_col()
smoke = read.table(file = "smoke.csv", header = T, sep = ",")
smoke$Alive = factor(smoke$Alive)
smoke$Smoker = factor(smoke$Smoker)
summary = smoke %>% group_by(Smoker, Alive) %>%
count() %>%  group_by(Smoker) %>% mutate(prop = n/sum(n))
summary
summary %>% ggplot(aes(x = Smoker, y = prop, fill = Alive)) +
geom_col()
model.crude = glm(Alive ~ Smoker, data = smoke, family = "binomial")
summary2 = smoke %>% group_by(Age,Smoker, Alive) %>%
count() %>%  group_by(Age,Smoker) %>% mutate(prop = n/sum(n))
View(summary2)
1/61
summary2 = smoke %>% group_by(Age,Smoker, Alive) %>%
count() %>%  group_by(Age,Smoker) %>% mutate(prop = n/sum(n)) %>%
filter(Alive == 1)
summary2 = smoke %>% group_by(Age,Smoker, Alive) %>%
count() %>%  group_by(Age,Smoker) %>% mutate(prop.alive = n/sum(n)) %>%
filter(Alive == 1) %>% select(Age,Smoker,prop.alive)
summary2 %>% ggplot(aes(x = Age, y = prop.alive, color = Smoker)) +
geom_point()
max(smoker$Age)
max(smoke$Age)
summary2 = smoke %>% group_by(Age,Smoker, Alive) %>%
count() %>%  group_by(Age,Smoker) %>% mutate(prop.alive = n/sum(n))
summary2 = smoke %>% group_by(Age,Smoker, Alive) %>%
count()
smoke %>% complete(Age,Smoker,Alive)
smoke %>% complete(Age,Smoker,Alive, fill = list(N = 0, freq = 0))
summary2 = smoke %>% group_by(Age,Smoker, Alive) %>%
count() %>%  group_by(Age,Smoker) %>% mutate(prop.alive = n/sum(n)) %>%
filter(Alive == 1) %>% select(Age,Smoker,prop.alive)
summary2 %>% ggplot(aes(x = Age, y = prop.alive, color = Smoker)) +
geom_point()
smoke %>% group_by(Age,Smoker, Alive) %>%
count()
summary2 = smoke %>% group_by(Age,Smoker, Alive) %>%
count()
summary2 = smoke %>% group_by(Age,Smoker, Alive) %>%
count() %>%  group_by(Age,Smoker) %>% mutate(prop.alive = n/sum(n)) %>%
filter(Alive == 1) %>% select(Age,Smoker,prop.alive)
library(Anova)
model.age_adjusted = glm(Alive ~ Smoker + Age, data = smoke, family = "binomial")
library(car)
Anova(model.age_adjusted, type = "III")
model.age_adjusted = glm(Alive ~ Smoker + Age, data = smoke, family = "binomial")
summary(model.age_adjusted)
Anova(model.age_adjusted, type = "III")
#remove older folks - no survivors 75 years or older.
smoke_cleaned = smoke %>% filter(Age < 70)
model.age_adjusted = glm(Alive ~ Smoker + Age, data = smoke_cleaned, family = "binomial")
summary(model.age_adjusted)
install.packages('car')
summary2
library(tidyverse)
smoke = read.table(file = "smoke.csv", header = T, sep = ",")
smoke$Alive = factor(smoke$Alive)
smoke$Smoker = factor(smoke$Smoker)
summary = smoke %>% group_by(Smoker, Alive) %>%
count() %>%  group_by(Smoker) %>% mutate(prop = n/sum(n))
summary %>% ggplot(aes(x = Smoker, y = prop, fill = Alive)) +
geom_col()
setwd("./Chapter_6/")
smoke = read.table(file = "smoke.csv", header = T, sep = ",")
smoke$Alive = factor(smoke$Alive)
smoke$Smoker = factor(smoke$Smoker)
summary = smoke %>% group_by(Smoker, Alive) %>%
count() %>%  group_by(Smoker) %>% mutate(prop = n/sum(n))
summary %>% ggplot(aes(x = Smoker, y = prop, fill = Alive)) +
geom_col()
model.crude = glm(Alive ~ Smoker, data = smoke, family = "binomial")
summary(model.crude)
summary2 = smoke %>% group_by(Age,Smoker, Alive) %>%
count() %>%  group_by(Age,Smoker) %>% mutate(prop.alive = n/sum(n)) %>%
filter(Alive == 1) %>% select(Age,Smoker,prop.alive)
summary2
smoke %>% left_join(summary2)
summary2
smoke %>% left_join(summary2)
smoke = smoke %>% left_join(summary2)
predict(model.age_adjusted, smoke)
smoke_cleaned = smoke %>% filter(Age < 70)
model.age_adjusted = glm(Alive ~ Smoker + Age, data = smoke_cleaned, family = "binomial")
summary(model.age_adjusted)
library(car)
Anova(model.age_adjusted, type = "III")
predict(model.age_adjusted, smoke)
predict(model.age_adjusted, smoke, type = "response")
smoke %>% mutate(pred.alive = predict(model.age_adjusted, smoke, type = "response"))
smoke = smoke %>% mutate(pred.alive = predict(model.age_adjusted, smoke, type = "response"))
head(smoke)
cor(smoke$prop.alive, smoke$pred.alive)
smoke_cleaned = smoke_cleaned %>% left_join(summary2)
smoke_cleaned = smoke %>% mutate(pred.alive = predict(model.age_adjusted, smoke_cleaned, type = "response"))
cor(smoke$prop.alive, smoke$pred.alive)
head(smoke_cleaned)
smoke_cleaned = smoke_cleaned %>% left_join(summary2)
head(smoke_cleaned)
smoke_cleaned = smoke_cleaned %>% mutate(pred.alive = predict(model.age_adjusted, smoke_cleaned, type = "response"))
cor(smoke$prop.alive, smoke$pred.alive)
cor(smoke_cleaned$prop.alive, smoke_cleaned$pred.alive)
View(smoke_cleaned)
smoke_cleaned %>% ggplot(aes(x = pred.alive, color = Alive)) +
geom_point()
smoke_cleaned %>% ggplot(aes(x = pred.alive, y = Alive)) +
geom_point()
smoke_cleaned %>% ggplot(aes(x = pred.alive, y = Alive)) +
geom_jitter()
smoke_cleaned %>% ggplot(aes(x = pred.alive, y = Alive)) +
geom_jitter(height = 0.2)
smoke_cleaned %>% ggplot(aes(x = pred.alive, y = Alive)) +
geom_jitter(height = 0.2, width = 0.1)
smoke_cleaned %>% ggplot(aes(x = pred.alive, y = Alive)) +
geom_jitter(height = 0.1, width = 0.05)
smoke_cleaned %>% ggplot(aes(x = pred.alive, y = Alive)) +
geom_jitter(height = 0.05, width = 0.025)
smoke_cleaned %>% ggplot(aes(x = pred.alive, y = Alive)) +
geom_jitter(height = 0.05, width = 0.025) + xlim(0,1)
smoke_cleaned %>% mutate(Alive.pred = ifelse(pred.alive > 0.5,
1, 0))
smoke_cleaned = smoke_cleaned %>%
mutate(Alive.pred = ifelse(pred.alive > 0.5,
1, 0))
smoke_cleaned %>% ggplot(aes(x = pred.alive,
y = Alive,
color = Alive.pred)) +
geom_jitter(height = 0.05, width = 0.025) + xlim(0,1)
smoke_cleaned = smoke_cleaned %>%
mutate(Alive.pred = factor(ifelse(pred.alive > 0.5,
1, 0)))
smoke_cleaned %>% ggplot(aes(x = pred.alive,
y = Alive,
color = Alive.pred)) +
geom_jitter(height = 0.05, width = 0.025) + xlim(0,1)
smoke_cleaned = smoke_cleaned %>%
mutate(Alive.pred = factor(ifelse(pred.alive > 0.5,
1, 0)))
smoke_cleaned %>% ggplot(aes(x = pred.alive,
y = Alive,
color = pred.Alive)) +
geom_jitter(height = 0.05, width = 0.025) + xlim(0,1)
smoke_cleaned %>% ggplot(aes(x = pred.alive,
y = Alive,
color = Alive.pred)) +
geom_jitter(height = 0.05, width = 0.025) + xlim(0,1)
smoke_cleaned = smoke_cleaned %>%
mutate(Alive.pred = factor(ifelse(pred.alive > 0.5,
1, 0)))
smoke_cleaned %>% ggplot(aes(x = pred.alive,
y = Alive,
color = Alive.pred)) +
geom_jitter(height = 0.05, width = 0.025) + xlim(0,1)
# Chunk 1: setup
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
# Chunk 2
smoke = read.table(file = "smoke.csv", header = T, sep = ",")
smoke$Alive = factor(smoke$Alive)
smoke$Smoker = factor(smoke$Smoker)
summary = smoke %>% group_by(Smoker, Alive) %>%
count() %>%  group_by(Smoker) %>% mutate(prop = n/sum(n))
summary %>% ggplot(aes(x = Smoker, y = prop, fill = Alive)) +
geom_col()
# Chunk 3
model.crude = glm(Alive ~ Smoker, data = smoke, family = "binomial")
summary(model.crude)
# Chunk 4
summary2 = smoke %>% group_by(Age,Smoker, Alive) %>%
count() %>%  group_by(Age,Smoker) %>% mutate(prop.alive = n/sum(n)) %>%
filter(Alive == 1) %>% select(Age,Smoker,prop.alive)
summary2 %>% ggplot(aes(x = Age, y = prop.alive, color = Smoker)) +
geom_point()
# Chunk 5
#remove older folks - no survivors 75 years or older.
smoke_cleaned = smoke %>% filter(Age < 70)
model.age_adjusted = glm(Alive ~ Smoker + Age, data = smoke_cleaned, family = "binomial")
summary(model.age_adjusted)
library(car)
Anova(model.age_adjusted, type = "III")
# Chunk 6
smoke_cleaned = smoke_cleaned %>% left_join(summary2)
smoke_cleaned = smoke_cleaned %>% mutate(pred.alive = predict(model.age_adjusted, smoke_cleaned, type = "response"))
cor(smoke_cleaned$prop.alive, smoke_cleaned$pred.alive)
smoke_cleaned = smoke_cleaned %>%
mutate(Alive.pred = factor(ifelse(pred.alive > 0.5,
1, 0)))
smoke_cleaned %>% ggplot(aes(x = pred.alive,
y = Alive,
color = Alive.pred)) +
geom_jitter(height = 0.05, width = 0.025) + xlim(0,1)
summary(smoke_cleaned$Alive.pred)
smoke_cleaned = smoked_cleaned %>%
mutate(correct.class = ifelse(Alive.pred == Alive,
1,0))
smoke_cleaned = smoke_cleaned %>%
mutate(correct.class = ifelse(Alive.pred == Alive,
1,0))
smoke_cleaned %>% ggplot(aes(x = pred.alive,
y = Alive,
color = correct.class)) +
geom_jitter(height = 0.05, width = 0.025) + xlim(0,1)
smoke_cleaned = smoke_cleaned %>%
mutate(correct.class = factor(ifelse(Alive.pred == Alive,
1,0)))
smoke_cleaned %>% ggplot(aes(x = pred.alive,
y = Alive,
color = correct.class)) +
geom_jitter(height = 0.05, width = 0.025) + xlim(0,1)
smoke_cleaned = smoke_cleaned %>%
mutate(correct.class = ifelse(Alive.pred == Alive,
1,0))
summary(smoke_cleaned$correct.class)
smoke_cleaned = smoke_cleaned %>%
mutate(correct.class = ifelse(Alive.pred == Alive,
"1","0"))
summary(smoke_cleaned$correct.class)
smoke_cleaned = smoke_cleaned %>%
mutate(correct.class = ifelse(Alive.pred == Alive,
1,0))
smoke_cleaned$correct.class = factor(smoke_cleaned$correct.class)
summary(smoke_cleaned$correct.class)
smoke_cleaned %>% ggplot(aes(x = pred.alive,
y = Alive,
color = correct.class)) +
geom_jitter(height = 0.05, width = 0.025) + xlim(0,1)
smoke_cleaned %>% ggplot(aes(x = pred.alive,
y = Alive,
color = correct.class)) +
geom_jitter(height = 0.05, width = 0.025) + xlim(0,1.2)
library(caret)
library(caret)
confusionMatrix(data = smoke_cleaned$Alive.pred,
reference = smoke_cleaned$Alive)
mean(smoke_cleaned$correct.class)
sum(smoke_cleaned$correct.class)
# Chunk 1: setup
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
# Chunk 2
smoke = read.table(file = "smoke.csv", header = T, sep = ",")
smoke$Alive = factor(smoke$Alive)
smoke$Smoker = factor(smoke$Smoker)
summary = smoke %>% group_by(Smoker, Alive) %>%
count() %>%  group_by(Smoker) %>% mutate(prop = n/sum(n))
summary %>% ggplot(aes(x = Smoker, y = prop, fill = Alive)) +
geom_col()
# Chunk 3
model.crude = glm(Alive ~ Smoker, data = smoke, family = "binomial")
summary(model.crude)
# Chunk 4
summary2 = smoke %>% group_by(Age,Smoker, Alive) %>%
count() %>%  group_by(Age,Smoker) %>% mutate(prop.alive = n/sum(n)) %>%
filter(Alive == 1) %>% select(Age,Smoker,prop.alive)
summary2 %>% ggplot(aes(x = Age, y = prop.alive, color = Smoker)) +
geom_point()
# Chunk 5
#remove older folks - no survivors 75 years or older.
smoke_cleaned = smoke %>% filter(Age < 70)
model.age_adjusted = glm(Alive ~ Smoker + Age, data = smoke_cleaned, family = "binomial")
summary(model.age_adjusted)
library(car)
Anova(model.age_adjusted, type = "III")
# Chunk 6
smoke_cleaned = smoke_cleaned %>% left_join(summary2)
smoke_cleaned = smoke_cleaned %>% mutate(pred.alive = predict(model.age_adjusted, smoke_cleaned, type = "response"))
cor(smoke_cleaned$prop.alive, smoke_cleaned$pred.alive)
smoke_cleaned = smoke_cleaned %>%
mutate(Alive.pred = factor(ifelse(pred.alive > 0.5,
1, 0)))
smoke_cleaned = smoke_cleaned %>%
mutate(correct.class = ifelse(Alive.pred == Alive,
1,0))
smoke_cleaned %>% ggplot(aes(x = pred.alive,
y = Alive,
color = factor(correct.class))) +
geom_jitter(height = 0.05, width = 0.025) + xlim(0,1.2)
mean(smoke_cleaned$correct.class)
confusionMatrix(data = smoke_cleaned$Alive.pred,
reference = smoke_cleaned$Alive)
smoke_cleaned %>% ggplot(aes(x = pred.alive,
y = Alive,
color = factor(correct.class))) +
geom_jitter(height = 0.05, width = 0.025) + xlim(0,1.2) +
geom_vline(xintercept = 0.5)
model.interaction = glm(Alive ~ Smoker*Age,
data = smoke_cleaned,
family = "binomial")
summary(model.interaction)
setwd("./Chapter_6/")
# Chunk 1: setup
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
# Chunk 2
smoke = read.table(file = "smoke.csv", header = T, sep = ",")
smoke$Alive = factor(smoke$Alive)
smoke$Smoker = factor(smoke$Smoker)
summary = smoke %>% group_by(Smoker, Alive) %>%
count() %>%  group_by(Smoker) %>% mutate(prop = n/sum(n))
summary %>% ggplot(aes(x = Smoker, y = prop, fill = Alive)) +
geom_col()
# Chunk 3
model.crude = glm(Alive ~ Smoker, data = smoke, family = "binomial")
summary(model.crude)
# Chunk 4
summary2 = smoke %>% group_by(Age,Smoker, Alive) %>%
count() %>%  group_by(Age,Smoker) %>% mutate(prop.alive = n/sum(n)) %>%
filter(Alive == 1) %>% select(Age,Smoker,prop.alive)
summary2 %>% ggplot(aes(x = Age, y = prop.alive, color = Smoker)) +
geom_point()
# Chunk 5
#remove older folks - no survivors 75 years or older.
smoke_cleaned = smoke %>% filter(Age < 70)
model.age_adjusted = glm(Alive ~ Smoker + Age, data = smoke_cleaned, family = "binomial")
summary(model.age_adjusted)
library(car)
Anova(model.age_adjusted, type = "III")
# Chunk 6
smoke_cleaned = smoke_cleaned %>% left_join(summary2)
smoke_cleaned = smoke_cleaned %>% mutate(pred.alive = predict(model.age_adjusted, smoke_cleaned, type = "response"))
cor(smoke_cleaned$prop.alive, smoke_cleaned$pred.alive)
# Chunk 7
smoke_cleaned = smoke_cleaned %>%
mutate(Alive.pred = factor(ifelse(pred.alive > 0.5,
1, 0)))
smoke_cleaned = smoke_cleaned %>%
mutate(correct.class = ifelse(Alive.pred == Alive,
1,0))
smoke_cleaned %>% ggplot(aes(x = pred.alive,
y = Alive,
color = factor(correct.class))) +
geom_jitter(height = 0.05, width = 0.025) + xlim(0,1.2) +
geom_vline(xintercept = 0.5)
# Chunk 8
library(caret)
confusionMatrix(data = smoke_cleaned$Alive.pred,
reference = smoke_cleaned$Alive)
View(summary)
View(smoke_cleaned)
