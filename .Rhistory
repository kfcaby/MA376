group_by() %>% mutate(expected_per = n/sum(n))
redsox %>% group_by(`Home/Away`,Result) %>% count() %>%
group_by(Result) %>% mutate(expected_per = n/sum(n))
redsox %>% group_by(`Home/Away`,Result) %>% count() %>%
group_by() %>%group_by(Result) %>% mutate(expected_per = n/sum(n))
redsox %>% group_by(`Home/Away`,Result) %>% count() %>%
group_by(Result) %>% mutate(expected_per = n/sum(n))
redsox %>% group_by(`Home/Away`,Result) %>% count() %>%
mutate(expected_per = n/sum(n))
redsox %>% group_by(`Home/Away`,Result) %>% count() %>%
mutate(expected_per = n/sum(n))
redsox %>% group_by(`Home/Away`,Result) %>% count() %>%
group_by(Result) %>% mutate(expected_per = n/sum(n))
redsox %>%
group_by(`Home/Away`,Result) %>%
count() %>%
group_by(Result) %>%
mutate(expected_per = sum(n))
redsox %>%
group_by(`Home/Away`,Result) %>%
count() %>%
group_by() %>%
mutate(expected_per = sum(n))
redsox %>%
group_by(`Home/Away`,Result) %>%
count() %>%
group_by(`Home/Away`)
redsox %>%
group_by(`Home/Away`,Result) %>%
count() %>%
group_by(`Home/Away`) %>%
mutate(n.games = sum(n))
redsox %>%
group_by(`Home/Away`,Result) %>%
count() %>%
group_by(`Home/Away`) %>%
mutate(n.games = sum(n)) %>%
group_by(Result) %>%
mutate(overall_perc = n/sum(n))
redsox %>%
group_by(`Home/Away`,Result) %>%
count() %>%
group_by(`Home/Away`) %>%
mutate(n.games = sum(n)) %>%
group_by() %>%
group_by(Result) %>%
mutate(overall_perc = n/sum(n))
# Chunk 1: setup
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(knitr)
redsox = read_csv(file = "Red Sox Season")
redsox = redsox %>% mutate(Result = factor(str_sub(`W/L`,start = 0, end = 1),
levels = c("W","L")))
redsox = redsox %>% mutate(Field = case_when(is.na(X5) ~ "Home",
TRUE ~ "Away"))
# Chunk 2
head(redsox %>% select(`Gm#`,Tm,Opp,Result, Field))
summary = redsox %>%
group_by(Field)%>%
count(Result) %>%
spread(key = Field, value = n)
kable(summary, caption = "Results of the Red Sox 2018 Season")
# Chunk 3
measures = data.frame(prob = seq(0,1, by = 0.05))
measures = measures %>% mutate(odds = prob/(1-prob))
measures %>% ggplot(aes(x = prob, y = odds)) +
geom_line() +
geom_line(aes(y = prob))
phat_home = 57/81
phat_away = 51/81
phat = 108/162
#standardized statistic (pg 420)
z = (phat_home - phat_away)/sqrt(phat*(1-phat)*(1/81 + 1/81))
#p-value
2*(1-pnorm(z,0,1))
z
summary_overall = redsox %>% group_by(Result) %>%
count() %>% group_by() %>% mutate(perc = n/sum(n)) %>%
select(-n)
#calculate expected wins
summary_homeaway = redsox %>%
group_by(Field,Result) %>%
count() %>%
left_join(summary_overall, by = "Result") %>%
group_by(Field) %>%
mutate(expected = perc*sum(n))
summary_homeaway
#calculate chi-square statistic
chisq = summary_homeaway %>% group_by() %>%
summarise(chisq = sum((n - expected)^2/expected))
# Chunk 1: setup
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(knitr)
redsox = read_csv(file = "Red Sox Season")
redsox = redsox %>% mutate(Result = factor(str_sub(`W/L`,start = 0, end = 1),
levels = c("W","L")))
redsox = redsox %>% mutate(Field = case_when(is.na(X5) ~ "Home",
TRUE ~ "Away"))
# Chunk 2
head(redsox %>% select(`Gm#`,Tm,Opp,Result, Field))
summary = redsox %>%
group_by(Field)%>%
count(Result) %>%
spread(key = Field, value = n)
kable(summary, caption = "Results of the Red Sox 2018 Season")
# Chunk 3
measures = data.frame(prob = seq(0,1, by = 0.05))
measures = measures %>% mutate(odds = prob/(1-prob))
measures %>% ggplot(aes(x = prob, y = odds)) +
geom_line() +
geom_line(aes(y = prob))
# Chunk 4
# two-sample z-test
phat_home = 57/81
phat_away = 51/81
phat = 108/162
#standardized statistic (pg 420)
z = (phat_home - phat_away)/sqrt(phat*(1-phat)*(1/81 + 1/81))
#p-value
2*(1-pnorm(z,0,1))
setwd("./Chapter_6/")
# Chunk 1: setup
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(knitr)
redsox = read_csv(file = "Red Sox Season")
redsox = redsox %>% mutate(Result = factor(str_sub(`W/L`,start = 0, end = 1),
levels = c("W","L")))
redsox = redsox %>% mutate(Field = case_when(is.na(X5) ~ "Home",
TRUE ~ "Away"))
# Chunk 2
head(redsox %>% select(`Gm#`,Tm,Opp,Result, Field))
summary = redsox %>%
group_by(Field)%>%
count(Result) %>%
spread(key = Field, value = n)
kable(summary, caption = "Results of the Red Sox 2018 Season")
# Chunk 3
measures = data.frame(prob = seq(0,1, by = 0.05))
measures = measures %>% mutate(odds = prob/(1-prob))
measures %>% ggplot(aes(x = prob, y = odds)) +
geom_line() +
geom_line(aes(y = prob))
# Chunk 4
# two-sample z-test
phat_home = 57/81
phat_away = 51/81
phat = 108/162
#standardized statistic (pg 420)
z = (phat_home - phat_away)/sqrt(phat*(1-phat)*(1/81 + 1/81))
#p-value
2*(1-pnorm(z,0,1))
#calculate overall win/loss percentage
summary_overall = redsox %>% group_by(Result) %>%
count() %>% group_by() %>% mutate(perc = n/sum(n)) %>%
select(-n)
#calculate expected wins
summary_homeaway = redsox %>%
group_by(Field,Result) %>%
count() %>%
left_join(summary_overall, by = "Result") %>%
group_by(Field) %>%
mutate(expected = perc*sum(n))
summary_homeaway
#calculate chi-square statistic
chisq = summary_homeaway %>% group_by() %>%
summarise(chisq = sum((n - expected)^2/expected))
1- pchisq(chisq$chisq, 1)
chisq
1- pchisq(chisq$chisq, 1)
# Chunk 1: setup
knitr::opts_chunk$set(echo = TRUE)
# Chunk 2
library(tidyverse)
teens = read.table(file = "http://www.isi-stats.com/isi2/data/FEV.txt",
header = T)
teens$Smoker = factor(teens$Smoker) #convert quantitative variable to categorical
head(teens)
# Chunk 3
teens %>% ggplot(aes(x = Smoker, y = FEV)) + geom_boxplot()
# Chunk 4
model_smoker = lm(FEV ~ Smoker, data = teens)
summary(model_smoker)
# Chunk 5
library(gridExtra)
p1 = teens %>% ggplot(aes(x = Smoker, y = Age)) + geom_boxplot()
p2 = teens %>% ggplot(aes(x = Age, y = FEV)) + geom_point()
grid.arrange(p1,p2, ncol = 2)
# Chunk 6
model_smoker_age = lm(FEV ~ Smoker + Age, data = teens)
summary(model_smoker_age)
# Chunk 7
model_smoker_age %>%
fortify() %>%
ggplot(aes(x = Age, y = FEV, color = Smoker)) +
geom_point() +
geom_line(aes(y = .fitted, color = Smoker))
View(teens)
model_gender(lm(FEV ~ Smoker + Age + Gender))
model_gender = lm(FEV ~ Smoker + Age + Gender, data = teens)
summary(model_gender)
teens = read.table(file = "http://www.isi-stats.com/isi2/data/FEV.txt",
header = T)
model_age %>% fortify()
# Chunk 1: setup
knitr::opts_chunk$set(echo = TRUE)
# Chunk 2
library(tidyverse)
# Chunk 3
smoke = read.table(file = "smoke.csv", header = T, sep = ",")
smoke$Alive = factor(smoke$Alive)
smoke$Smoker = factor(smoke$Smoker)
smoke %>% group_by(Smoker,Alive) %>% count() %>% spread(key = "Smoker",value = "n")
smoke %>% ggplot(aes(x = Age, y = Smoker, color = Alive)) + geom_jitter(width = 2, height = 0.2)
# Chunk 4
#Let's look at a plot of age vs proportion alive
summary = smoke %>% count(Age, Alive) %>%
group_by(Age) %>%
mutate(Alive_proportion = n/sum(n),
total = sum(n)) %>%
filter(Alive == 1) %>% select(-c(Alive,n))
summary %>%
ggplot(aes(x = Age, y = Alive_proportion)) +
geom_point()
# Chunk 5
summary = summary %>%
mutate(logOdds = log(Alive_proportion/(1-Alive_proportion)))
summary %>% ggplot(aes(x = Age, y = logOdds)) +
geom_point()
# Chunk 6
# In practice, we would just do this:
model_age = glm(Alive ~ Age, data = smoke, family = "binomial")
summary(model_age)
setwd("./Chapter_6/")
# Chunk 1: setup
knitr::opts_chunk$set(echo = TRUE)
# Chunk 2
library(tidyverse)
# Chunk 3
smoke = read.table(file = "smoke.csv", header = T, sep = ",")
smoke$Alive = factor(smoke$Alive)
smoke$Smoker = factor(smoke$Smoker)
smoke %>% group_by(Smoker,Alive) %>% count() %>% spread(key = "Smoker",value = "n")
smoke %>% ggplot(aes(x = Age, y = Smoker, color = Alive)) + geom_jitter(width = 2, height = 0.2)
# Chunk 4
#Let's look at a plot of age vs proportion alive
summary = smoke %>% count(Age, Alive) %>%
group_by(Age) %>%
mutate(Alive_proportion = n/sum(n),
total = sum(n)) %>%
filter(Alive == 1) %>% select(-c(Alive,n))
summary %>%
ggplot(aes(x = Age, y = Alive_proportion)) +
geom_point()
# Chunk 5
summary = summary %>%
mutate(logOdds = log(Alive_proportion/(1-Alive_proportion)))
summary %>% ggplot(aes(x = Age, y = logOdds)) +
geom_point()
# Chunk 6
# In practice, we would just do this:
model_age = glm(Alive ~ Age, data = smoke, family = "binomial")
summary(model_age)
model_age %>% fortify()
smoke$predicted = model_age %>% fortify() %>% select(.fitted)
View(smoke)
smoke = smoke %>% mutate(pred_Prob = exp(predicted)/(1 + exp(predicted)))
smoke = smoke %>% mutate(pred_Prob = exp(predicted..fitted)/(1 + exp(predicted..fitted)))
summary_model = model_age %>% fortify()
summary_model = summary_model %>% mutate(predicted_prob = exp(.fitted)/(1 + exp(.fitted)))
View(summary_model)
plot(model_age)
model_smoker = glm(Alive ~ Smoker, data = smoke, family = "binomial")
summary(model_smoker)
View(summary)
log((443/582)/(502/732))
log((443/(582-483))/(502/(732-502)))
log(502/230)
model_smoker = glm(Alive ~ Smoker, data = smoke, family = "binomial")
summary(model_smoker)
p = 502/732
log(p/(1-p))
log(443/(582-443)) - log(502/(732/502))
log(443/(582-443)) - log(502/(732-502))
# Chunk 1: setup
knitr::opts_chunk$set(echo = TRUE)
# Chunk 2
library(tidyverse)
# Chunk 3
smoke = read.table(file = "smoke.csv", header = T, sep = ",")
smoke$Alive = factor(smoke$Alive)
smoke$Smoker = factor(smoke$Smoker)
smoke %>% group_by(Smoker,Alive) %>% count() %>% spread(key = "Smoker",value = "n")
smoke %>% ggplot(aes(x = Age, y = Smoker, color = Alive)) + geom_jitter(width = 2, height = 0.2)
# Chunk 4
#Let's look at a plot of age vs proportion alive
summary = smoke %>% count(Age, Alive) %>%
group_by(Age) %>%
mutate(Alive_proportion = n/sum(n),
total = sum(n)) %>%
filter(Alive == 1) %>% select(-c(Alive,n))
summary %>%
ggplot(aes(x = Age, y = Alive_proportion)) +
geom_point()
# Chunk 5
summary = summary %>%
mutate(logOdds = log(Alive_proportion/(1-Alive_proportion)))
summary %>% ggplot(aes(x = Age, y = logOdds)) +
geom_point()
# Chunk 6
# In practice, we would just do this:
model_age = glm(Alive ~ Age, data = smoke, family = "binomial")
summary(model_age)
# Chunk 7
summary_model = model_age %>% fortify()
summary_model = summary_model %>% mutate(predicted_prob = exp(.fitted)/(1 + exp(.fitted)))
# Chunk 8
model_smoker = glm(Alive ~ Smoker, data = smoke, family = "binomial")
summary(model_smoker)
setwd("./Chapter_6/")
# Chunk 1: setup
knitr::opts_chunk$set(echo = TRUE)
# Chunk 2
library(tidyverse)
# Chunk 3
smoke = read.table(file = "smoke.csv", header = T, sep = ",")
smoke$Alive = factor(smoke$Alive)
smoke$Smoker = factor(smoke$Smoker)
smoke %>% group_by(Smoker,Alive) %>% count() %>% spread(key = "Smoker",value = "n")
smoke %>% ggplot(aes(x = Age, y = Smoker, color = Alive)) + geom_jitter(width = 2, height = 0.2)
# Chunk 4
#Let's look at a plot of age vs proportion alive
summary = smoke %>% count(Age, Alive) %>%
group_by(Age) %>%
mutate(Alive_proportion = n/sum(n),
total = sum(n)) %>%
filter(Alive == 1) %>% select(-c(Alive,n))
summary %>%
ggplot(aes(x = Age, y = Alive_proportion)) +
geom_point()
# Chunk 5
summary = summary %>%
mutate(logOdds = log(Alive_proportion/(1-Alive_proportion)))
summary %>% ggplot(aes(x = Age, y = logOdds)) +
geom_point()
# Chunk 6
# In practice, we would just do this:
model_age = glm(Alive ~ Age, data = smoke, family = "binomial")
summary(model_age)
# Chunk 7
summary_model = model_age %>% fortify()
summary_model = summary_model %>% mutate(predicted_prob = exp(.fitted)/(1 + exp(.fitted)))
# Chunk 8
model_smoker = glm(Alive ~ Smoker, data = smoke, family = "binomial")
summary(model_smoker)
smoke %>% group_by(Smoker,Alive) %>% count() %>% spread(key = "Smoker",value = "n")
table_smoke = smoke %>% group_by(Smoker,Alive) %>% count() %>% spread(key = "Smoker",value = "n")
table_smoke
chisq.test(table_smoke)
chisq.test(as.matrix(table_smoke))
table_smoke
chisq.test(table_smoke$`1`,table_smoke$`0`)
prop.test(c(443,582),c(502,732))
prop.test(c(443,582),c(502,732), correct = FALSE)
prop.test(c(443,582,20),c(502,732,100), correct = FALSE)
prop.test(c(443,582),c(502,732), correct = FALSE)
table_smoke
0.89^2
10*log(5)
log(5)^10
mtcars
model_crude = lm(mpg ~ wt, data = mtcars)
summary(model_crude)
model_transmission = lm(mpg ~ am, data = mtcars)
summary(model_transmission)
model_adj = lm(mpg ~ am + hp, data = mtcars)
summary(model_adj)
model_adj = lm(mpg ~ am + wt, data = mtcars)
summary(model_adj)
model_adj = lm(mpg ~ am + cyl, data = mtcars)
summary(model_adj)
mtcars %>% filter(am == 1)
mtcars %>% summarise(mean(mpg))
mtcars %>% group_by() %>% summarise(mean(mpg))
mtcars %>% group_by(am) %>% summarise(mean(mpg))
mtcars %>% group_by(am, cyl) %>% summarise(mean(mpg))
mtcars %>% group_by(cyl, am) %>% summarise(mean(mpg))
mtcars %>% group_by(wt, am) %>% summarise(mean(mpg))
mtcars %>% group_by(am) %>% summarise(mean(mpg))
mtcars %>% group_by(cyl, am) %>% summarise(mean(mpg))
mtcars %>% ggplot(aes(x = wt, y = mpg)) %>% geom_point()
mtcars %>% ggplot(aes(x = wt, y = mpg)) + geom_point()
mtcars %>% ggplot(aes(x = wt, y = mpg, color = am)) + geom_point()
mtcars %>% ggplot(aes(x = wt, y = mpg, color = factor(am))) + geom_point()
dim(mtcars)
model_adj = lm(mpg ~ am + wt + hp, data = mtcars)
summary(model_adj)
mtcars
model_adj = lm(mpg ~ am + wt + hp, data = mtcars)
summary(model_adj)
model_adj = lm(mpg ~ am + hp/disp], data = mtcars)
model_adj = lm(mpg ~ am + hp/disp, data = mtcars)
summary(model_adj)
smoke %>% ggplot(aes(x = smoker)) + geom_bar()
library(tidyverse)
smoke %>% ggplot(aes(x = smoker)) + geom_bar()
smoke = read.table(file = "smoke.csv", header = T, sep = ",")
smoke$Alive = factor(smoke$Alive)
smoke$Smoker = factor(smoke$Smoker)
smoke %>% ggplot(aes(x = smoker)) + geom_bar()
setwd("./Chapter_6/")
smoke = read.table(file = "smoke.csv", header = T, sep = ",")
smoke$Alive = factor(smoke$Alive)
smoke$Smoker = factor(smoke$Smoker)
smoke %>% ggplot(aes(x = smoker)) + geom_bar()
smoke %>% ggplot(aes(x = Smoker)) + geom_bar()
smoke %>% ggplot(aes(x = Smoker, color = Alive)) + geom_bar()
smoke %>% ggplot(aes(x = Smoker, fill = Alive)) + geom_bar()
smoke %>% ggplot(aes(x = Smoker, fill = Alive)) + geom_bar(stat = "proportion")
smoke %>% ggplot(aes(x = Smoker, fill = Alive)) + geom_bar(stat = "percent")
smoke %>% ggplot(aes(x = Smoker, fill = Alive)) + geom_bar(stat = "ratio")
smoke %>% ggplot(aes(x = Smoker, y = ..prop.., fill = Alive)) + geom_bar(stat = "ratio")
smoke %>% ggplot(aes(x = Smoker, y = ..prop.., fill = Alive)) + geom_bar()
smoke %>% ggplot(aes(x = Smoker, fill = Alive)) + geom_bar()
smoke %>% ggplot(aes(x = Smoker, fill = Alive)) + geom_bar(stat = "identity")
smoke %>% ggplot(aes(x = Smoker, y = Alive)) + geom_bar(stat = "identity")
smoke %>% ggplot(aes(x = Smoker, fill = Alive)) + geom_bar(stat = "identity")
smoke %>% group_by(Smoker) %>% summarise(prop.alive = mean(Alive))
smoke %>% group_by(Smoker) %>% summarise(prop = n()/sum(n()))
smoke %>% group_by(Smoker, Alive) %>% summarise(prop = n()/sum(n()))
smoke %>% group_by(Smoker, Alive) %>% count()
smoke %>% group_by(Smoker, Alive) %>% count() %>% summarise(prop = n/sum(n))
smoke %>% group_by(Smoker, Alive) %>%
count() %>% group_by(Smoker) %>% summarise(prop = n/sum(n))
smoke %>% group_by(Smoker, Alive) %>%
count() %>% group_by(Smoker) %>% summarise(prop = n/sum(n))
smoke %>% group_by(Smoker, Alive) %>%
count()
smoke %>% group_by(Smoker, Alive) %>%
count() %>% group_by(Smoker) %>% summarise(prop = n/sum(n))
smoke %>% group_by(Smoker, Alive) %>%
count() %>%  summarise(prop = n/sum(n))
smoke %>% group_by(Smoker, Alive) %>%
count() %>%  group_by(Smoker) %>% mutate(prop = n/sum(n))
166/(166+502)
summary %>% ggplot(aes(x = Smoker, y = prop, fill = Alive)) +
geom_col()
summary = smoke %>% group_by(Smoker, Alive) %>%
count() %>%  group_by(Smoker) %>% mutate(prop = n/sum(n))
summary %>% ggplot(aes(x = Smoker, y = prop, fill = Alive)) +
geom_col()
smoke = read.table(file = "smoke.csv", header = T, sep = ",")
smoke$Alive = factor(smoke$Alive)
smoke$Smoker = factor(smoke$Smoker)
summary = smoke %>% group_by(Smoker, Alive) %>%
count() %>%  group_by(Smoker) %>% mutate(prop = n/sum(n))
summary %>% ggplot(aes(x = Smoker, y = prop, fill = Alive)) +
geom_col()
smoke = read.table(file = "smoke.csv", header = T, sep = ",")
smoke$Alive = factor(smoke$Alive)
smoke$Smoker = factor(smoke$Smoker)
summary = smoke %>% group_by(Smoker, Alive) %>%
count() %>%  group_by(Smoker) %>% mutate(prop = n/sum(n))
summary
summary %>% ggplot(aes(x = Smoker, y = prop, fill = Alive)) +
geom_col()
model.crude = glm(Alive ~ Smoker, data = smoke, family = "binomial")
summary2 = smoke %>% group_by(Age,Smoker, Alive) %>%
count() %>%  group_by(Age,Smoker) %>% mutate(prop = n/sum(n))
View(summary2)
1/61
summary2 = smoke %>% group_by(Age,Smoker, Alive) %>%
count() %>%  group_by(Age,Smoker) %>% mutate(prop = n/sum(n)) %>%
filter(Alive == 1)
summary2 = smoke %>% group_by(Age,Smoker, Alive) %>%
count() %>%  group_by(Age,Smoker) %>% mutate(prop.alive = n/sum(n)) %>%
filter(Alive == 1) %>% select(Age,Smoker,prop.alive)
summary2 %>% ggplot(aes(x = Age, y = prop.alive, color = Smoker)) +
geom_point()
max(smoker$Age)
max(smoke$Age)
summary2 = smoke %>% group_by(Age,Smoker, Alive) %>%
count() %>%  group_by(Age,Smoker) %>% mutate(prop.alive = n/sum(n))
summary2 = smoke %>% group_by(Age,Smoker, Alive) %>%
count()
smoke %>% complete(Age,Smoker,Alive)
smoke %>% complete(Age,Smoker,Alive, fill = list(N = 0, freq = 0))
summary2 = smoke %>% group_by(Age,Smoker, Alive) %>%
count() %>%  group_by(Age,Smoker) %>% mutate(prop.alive = n/sum(n)) %>%
filter(Alive == 1) %>% select(Age,Smoker,prop.alive)
summary2 %>% ggplot(aes(x = Age, y = prop.alive, color = Smoker)) +
geom_point()
smoke %>% group_by(Age,Smoker, Alive) %>%
count()
summary2 = smoke %>% group_by(Age,Smoker, Alive) %>%
count()
summary2 = smoke %>% group_by(Age,Smoker, Alive) %>%
count() %>%  group_by(Age,Smoker) %>% mutate(prop.alive = n/sum(n)) %>%
filter(Alive == 1) %>% select(Age,Smoker,prop.alive)
library(Anova)
model.age_adjusted = glm(Alive ~ Smoker + Age, data = smoke, family = "binomial")
library(car)
Anova(model.age_adjusted, type = "III")
model.age_adjusted = glm(Alive ~ Smoker + Age, data = smoke, family = "binomial")
summary(model.age_adjusted)
Anova(model.age_adjusted, type = "III")
#remove older folks - no survivors 75 years or older.
smoke_cleaned = smoke %>% filter(Age < 70)
model.age_adjusted = glm(Alive ~ Smoker + Age, data = smoke_cleaned, family = "binomial")
summary(model.age_adjusted)
